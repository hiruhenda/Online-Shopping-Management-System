/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: jetty/9.4.53.v20231009
 * Generated at: 2026-01-15 06:57:24 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import java.util.List;
import java.util.Map;
import java.util.HashMap;
import com.mycompany.onlineshoppingcart.model.Order;
import com.mycompany.onlineshoppingcart.model.OrderItem;
import com.mycompany.onlineshoppingcart.model.Product;
import com.mycompany.onlineshoppingcart.dao.ProductDAO;
import java.text.SimpleDateFormat;
import java.util.Calendar;

public final class orders_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.HashSet<>();
    _jspx_imports_packages.add("javax.servlet");
    _jspx_imports_packages.add("javax.servlet.http");
    _jspx_imports_packages.add("javax.servlet.jsp");
    _jspx_imports_classes = new java.util.HashSet<>();
    _jspx_imports_classes.add("com.mycompany.onlineshoppingcart.model.Order");
    _jspx_imports_classes.add("java.util.List");
    _jspx_imports_classes.add("java.util.Calendar");
    _jspx_imports_classes.add("java.util.Map");
    _jspx_imports_classes.add("com.mycompany.onlineshoppingcart.model.OrderItem");
    _jspx_imports_classes.add("com.mycompany.onlineshoppingcart.dao.ProductDAO");
    _jspx_imports_classes.add("java.text.SimpleDateFormat");
    _jspx_imports_classes.add("java.util.HashMap");
    _jspx_imports_classes.add("com.mycompany.onlineshoppingcart.model.Product");
  }

  private volatile javax.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
      throws java.io.IOException, javax.servlet.ServletException {

    final java.lang.String _jspx_method = request.getMethod();
    if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
      return;
    }

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html; charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");

    List<Order> orders = (List<Order>) request.getAttribute("orders");
    SimpleDateFormat dateFormat = new SimpleDateFormat("dd MMM yyyy");
    SimpleDateFormat dateTimeFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm");
    
    // Create a map to store product images
    Map<Integer, String> productImages = new HashMap<>();
    ProductDAO productDAO = new ProductDAO();
    
    if (orders != null) {
        for (Order order : orders) {
            for (OrderItem item : order.getItems()) {
                if (!productImages.containsKey(item.getProductId())) {
                    Product product = productDAO.getProductById(item.getProductId());
                    if (product != null && product.getImageUrl() != null && !product.getImageUrl().isEmpty()) {
                        productImages.put(item.getProductId(), product.getImageUrl());
                    } else {
                        productImages.put(item.getProductId(), "https://via.placeholder.com/100x100?text=No+Image");
                    }
                }
            }
        }
    }
    
    // Calculate estimated arrival date (7 days from order date)
    Calendar cal = Calendar.getInstance();

      out.write("\n");
      out.write("<!DOCTYPE html>\n");
      out.write("<html lang=\"en\">\n");
      out.write("<head>\n");
      out.write("    <meta charset=\"UTF-8\">\n");
      out.write("    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n");
      out.write("    <title>My Orders - Online Shopping Cart</title>\n");
      out.write("    <!-- Google Fonts -->\n");
      out.write("    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n");
      out.write("    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n");
      out.write("    <link href=\"https://fonts.googleapis.com/css2?family=Belleza&family=Tinos:ital,wght@0,400;0,700;1,400&family=Smooch+Sans:wght@100..1000&display=swap\" rel=\"stylesheet\">\n");
      out.write("    <link rel=\"stylesheet\" type=\"text/css\" href=\"css/style.css\">\n");
      out.write("    <link rel=\"stylesheet\" type=\"text/css\" href=\"css/orders.css\">\n");
      out.write("</head>\n");
      out.write("<body>\n");
      out.write("    ");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "header.jsp", out, false);
      out.write("\n");
      out.write("    \n");
      out.write("    <div class=\"orders-page\">\n");
      out.write("        <div class=\"orders-container\">\n");
      out.write("            <!-- Page Title -->\n");
      out.write("            <h1 class=\"orders-title\">My Orders</h1>\n");
      out.write("            \n");
      out.write("            <!-- Status Tabs -->\n");
      out.write("            <div class=\"orders-tabs\">\n");
      out.write("                <button class=\"tab-btn active\" data-status=\"shipping\">\n");
      out.write("                    <span>On Shipping</span>\n");
      out.write("                    <span class=\"tab-badge\" id=\"shipping-count\">0</span>\n");
      out.write("                </button>\n");
      out.write("                <button class=\"tab-btn\" data-status=\"arrived\">\n");
      out.write("                    <span>Arrived</span>\n");
      out.write("                    <svg class=\"tab-icon\" width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n");
      out.write("                        <path d=\"M3 4.5L6 7.5L9 4.5\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n");
      out.write("                    </svg>\n");
      out.write("                </button>\n");
      out.write("                <button class=\"tab-btn\" data-status=\"canceled\">\n");
      out.write("                    <span>Canceled</span>\n");
      out.write("                </button>\n");
      out.write("            </div>\n");
      out.write("            \n");
      out.write("            <!-- Orders List -->\n");
      out.write("            <div class=\"orders-list\" id=\"ordersList\">\n");
      out.write("                ");

                    if (orders != null && !orders.isEmpty()) {
                        int shippingCount = 0;
                        int arrivedCount = 0;
                        int canceledCount = 0;
                        
                        // Count orders by status
                        for (Order order : orders) {
                            String status = order.getStatus().toLowerCase();
                            if (status.contains("shipped") || status.contains("processing") || status.contains("pending")) {
                                shippingCount++;
                            } else if (status.contains("delivered") || status.contains("arrived")) {
                                arrivedCount++;
                            } else if (status.contains("cancel")) {
                                canceledCount++;
                            }
                        }
                
      out.write("\n");
      out.write("                <script>\n");
      out.write("                    document.getElementById('shipping-count').textContent = '");
      out.print( shippingCount );
      out.write("';\n");
      out.write("                </script>\n");
      out.write("                ");

                        for (Order order : orders) {
                            String status = order.getStatus().toLowerCase();
                            String orderStatusClass = "shipping";
                            String statusBadge = "On Deliver";
                            String statusBadgeClass = "status-on-deliver";
                            
                            if (status.contains("shipped") || status.contains("processing") || status.contains("pending")) {
                                orderStatusClass = "shipping";
                                statusBadge = "On Deliver";
                                statusBadgeClass = "status-on-deliver";
                            } else if (status.contains("delivered") || status.contains("arrived")) {
                                orderStatusClass = "arrived";
                                statusBadge = "Arrived";
                                statusBadgeClass = "status-arrived";
                            } else if (status.contains("cancel")) {
                                orderStatusClass = "canceled";
                                statusBadge = "Canceled";
                                statusBadgeClass = "status-canceled";
                            }
                            
                            // Calculate estimated arrival date
                            cal.setTime(order.getOrderDate());
                            cal.add(Calendar.DAY_OF_MONTH, 7);
                            String estimatedArrival = dateFormat.format(cal.getTime());
                            
                            // Format order ID
                            String orderIdFormatted = "CTH-" + String.format("%05d", order.getId());
                
      out.write("\n");
      out.write("                <div class=\"order-card\" data-status=\"");
      out.print( orderStatusClass );
      out.write("\">\n");
      out.write("                    <div class=\"order-card-header\">\n");
      out.write("                        <div class=\"order-id-section\">\n");
      out.write("                            <svg class=\"order-icon\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n");
      out.write("                                <path d=\"M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H19M17 13V17C17 18.1 17.9 19 19 19C20.1 19 21 18.1 21 17V13\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n");
      out.write("                            </svg>\n");
      out.write("                            <span class=\"order-id\">");
      out.print( orderIdFormatted );
      out.write("</span>\n");
      out.write("                        </div>\n");
      out.write("                        <span class=\"status-badge ");
      out.print( statusBadgeClass );
      out.write('"');
      out.write('>');
      out.print( statusBadge );
      out.write("</span>\n");
      out.write("                    </div>\n");
      out.write("                    \n");
      out.write("                    <div class=\"order-details\">\n");
      out.write("                        <div class=\"order-info-item\">\n");
      out.write("                            <svg class=\"info-icon\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n");
      out.write("                                <path d=\"M21 10C21 17 12 23 12 23S3 17 3 10C3 5.02944 7.02944 1 12 1C16.9706 1 21 5.02944 21 10Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n");
      out.write("                                <path d=\"M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n");
      out.write("                            </svg>\n");
      out.write("                            <span>Illinois, United States</span>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"order-info-item\">\n");
      out.write("                            <svg class=\"info-icon\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n");
      out.write("                                <path d=\"M8 2V6M16 2V6M3 10H21M5 4H19C20.1046 4 21 4.89543 21 6V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V6C3 4.89543 3.89543 4 5 4Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n");
      out.write("                            </svg>\n");
      out.write("                            <span>Estimated arrived ");
      out.print( estimatedArrival );
      out.write("</span>\n");
      out.write("                        </div>\n");
      out.write("                        <div class=\"order-info-item\">\n");
      out.write("                            <svg class=\"info-icon\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n");
      out.write("                                <path d=\"M21 10C21 17 12 23 12 23S3 17 3 10C3 5.02944 7.02944 1 12 1C16.9706 1 21 5.02944 21 10Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n");
      out.write("                                <path d=\"M12 13C13.6569 13 15 11.6569 15 10C15 8.34315 13.6569 7 12 7C10.3431 7 9 8.34315 9 10C9 11.6569 10.3431 13 12 13Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n");
      out.write("                            </svg>\n");
      out.write("                            <span>");
      out.print( order.getShippingAddress() != null ? order.getShippingAddress() : "Address not specified" );
      out.write("</span>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("                    \n");
      out.write("                    <div class=\"order-items\">\n");
      out.write("                        ");

                            for (OrderItem item : order.getItems()) {
                                String imageUrl = productImages.get(item.getProductId());
                                if (imageUrl == null) {
                                    imageUrl = "https://via.placeholder.com/100x100?text=No+Image";
                                }
                        
      out.write("\n");
      out.write("                        <div class=\"order-item\">\n");
      out.write("                            <img src=\"");
      out.print( imageUrl );
      out.write("\" alt=\"");
      out.print( item.getProductName() );
      out.write("\" class=\"order-item-image\">\n");
      out.write("                            <div class=\"order-item-info\">\n");
      out.write("                                <h4 class=\"order-item-name\">");
      out.print( item.getProductName() );
      out.write("</h4>\n");
      out.write("                                <div class=\"order-item-meta\">\n");
      out.write("                                    <span class=\"order-item-price\">Rp ");
      out.print( String.format("%,.0f", item.getPrice().doubleValue()) );
      out.write("</span>\n");
      out.write("                                    <span class=\"order-item-size\">M</span>\n");
      out.write("                                </div>\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                        ");

                            }
                        
      out.write("\n");
      out.write("                    </div>\n");
      out.write("                    \n");
      out.write("                    <div class=\"order-footer\">\n");
      out.write("                        <div class=\"order-total\">\n");
      out.write("                            <span class=\"total-label\">Total:</span>\n");
      out.write("                            <span class=\"total-amount\">Rp ");
      out.print( String.format("%,.0f", order.getTotalAmount().doubleValue()) );
      out.write("</span>\n");
      out.write("                        </div>\n");
      out.write("                        <button class=\"btn-details\" onclick=\"viewOrderDetails(");
      out.print( order.getId() );
      out.write(")\">Details</button>\n");
      out.write("                    </div>\n");
      out.write("                </div>\n");
      out.write("                ");

                        }
                    } else {
                
      out.write("\n");
      out.write("                <div class=\"empty-orders\">\n");
      out.write("                    <svg class=\"empty-icon\" width=\"64\" height=\"64\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n");
      out.write("                        <path d=\"M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H19M17 13V17C17 18.1 17.9 19 19 19C20.1 19 21 18.1 21 17V13M9 19.5C9.8 19.5 10.5 20.2 10.5 21C10.5 21.8 9.8 22.5 9 22.5C8.2 22.5 7.5 21.8 7.5 21C7.5 20.2 8.2 19.5 9 19.5ZM20 19.5C20.8 19.5 21.5 20.2 21.5 21C21.5 21.8 20.8 22.5 20 22.5C19.2 22.5 18.5 21.8 18.5 21C18.5 20.2 19.2 19.5 20 19.5Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n");
      out.write("                    </svg>\n");
      out.write("                    <h3>You have no orders yet</h3>\n");
      out.write("                    <p>Start shopping to see your orders here</p>\n");
      out.write("                    <a href=\"products\" class=\"btn-start-shopping\">Start Shopping</a>\n");
      out.write("                </div>\n");
      out.write("                ");

                    }
                
      out.write("\n");
      out.write("            </div>\n");
      out.write("        </div>\n");
      out.write("    </div>\n");
      out.write("    \n");
      out.write("    ");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "footer.jsp", out, false);
      out.write("\n");
      out.write("    \n");
      out.write("    <script>\n");
      out.write("        function filterOrders(status, element) {\n");
      out.write("            // Update active tab\n");
      out.write("            document.querySelectorAll('.tab-btn').forEach(btn => {\n");
      out.write("                btn.classList.remove('active');\n");
      out.write("            });\n");
      out.write("            if (element) {\n");
      out.write("                element.classList.add('active');\n");
      out.write("            } else {\n");
      out.write("                document.querySelector(`[data-status=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${status}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null));
      out.write("\"]`)?.classList.add('active');\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("            // Filter orders\n");
      out.write("            const orders = document.querySelectorAll('.order-card');\n");
      out.write("            orders.forEach(order => {\n");
      out.write("                if (status === 'all' || order.getAttribute('data-status') === status) {\n");
      out.write("                    order.style.display = 'block';\n");
      out.write("                } else {\n");
      out.write("                    order.style.display = 'none';\n");
      out.write("                }\n");
      out.write("            });\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        function viewOrderDetails(orderId) {\n");
      out.write("            // Navigate to order details page or show modal\n");
      out.write("            window.location.href = 'order-details?id=' + orderId;\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        // Initialize: Show shipping orders by default\n");
      out.write("        document.addEventListener('DOMContentLoaded', function() {\n");
      out.write("            filterOrders('shipping');\n");
      out.write("            \n");
      out.write("            // Add click handlers to tab buttons\n");
      out.write("            document.querySelectorAll('.tab-btn').forEach(btn => {\n");
      out.write("                btn.addEventListener('click', function() {\n");
      out.write("                    const status = this.getAttribute('data-status');\n");
      out.write("                    filterOrders(status, this);\n");
      out.write("                });\n");
      out.write("            });\n");
      out.write("        });\n");
      out.write("    </script>\n");
      out.write("</body>\n");
      out.write("</html>\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
